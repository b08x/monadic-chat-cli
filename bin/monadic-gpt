#!/usr/bin/env ruby

# frozen_string_literal: true

require_relative "../lib/monadic_gpt"
require_relative "../lib/chat"
require_relative "../lib/code"
require_relative "../lib/novel"
require_relative "../lib/translate"

num = 60
mon = " /M/O/N/A/D/I/C/ "
gpt = " /G/P/T/ "
hpad = " " * ((num - (mon.size + gpt.size) - 1) / 2).to_i
cpad = MonadicGpt::PASTEL.on_cyan(" ")
montitle = MonadicGpt::PASTEL.on_green.bold(mon)
gpttitle = MonadicGpt::PASTEL.on_red.bold(gpt)
title = "#{hpad}#{montitle}#{cpad}#{gpttitle}#{hpad}"
title += ((num - (mon.size + gpt.size) - 1) % 2).zero? ? "" : " "
version = "Version: #{MonadicGpt::VERSION}".center(num, " ")
vpad = " " * num

banner = <<~BANNER
  #{MonadicGpt::PASTEL.on_blue(vpad)}
  #{MonadicGpt::PASTEL.on_cyan(vpad)}
  #{MonadicGpt::PASTEL.on_cyan(title)}
  #{MonadicGpt::PASTEL.on_cyan(vpad)}
  #{MonadicGpt::PASTEL.on_cyan(version)}
  #{MonadicGpt::PASTEL.on_cyan(vpad)}
  #{MonadicGpt::PASTEL.on_blue(vpad)}
BANNER

openai_completion = nil
parameter = ""

loop do
  MonadicGpt.clear_screen
  print TTY::Box.frame banner.strip

  openai_completion ||= MonadicGpt.authenticate

  MonadicGpt.prompt_monadic
  parameter = MonadicGpt::PROMPT.select(" Select app:", per_page: 6, cycle: false, default: 1) do |menu|
    menu.enum "."
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Chat")}      - #{MonadicGpt::Chat::DESC}", "chat"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Code")}      - #{MonadicGpt::Code::DESC}", "code"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Novel")}     - #{MonadicGpt::Novel::DESC}", "novel"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Translate")} - #{MonadicGpt::Translate::DESC}", "translate"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Quit")}      - Quit the app", "exit"
  end

  MonadicGpt.clear_screen

  case parameter
  when "chat"
    MonadicGpt::Chat.new(openai_completion).run
  when "code"
    MonadicGpt::Code.new(openai_completion).run
  when "novel"
    MonadicGpt::Novel.new(openai_completion).run
  when "translate"
    MonadicGpt::Translate.new(openai_completion).run
  when "exit"
    print "#{MonadicGpt::PASTEL.bold("Bye!")}\n"
    exit
  end
end
