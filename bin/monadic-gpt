#!/usr/bin/env ruby

# frozen_string_literal: true

require_relative "../lib/monadic_gpt"
require_relative "../lib/chat"
require_relative "../lib/code"
require_relative "../lib/novel"
require_relative "../lib/translate"

title = "/M/O/N/A/D/I/C/ /G/P/T/".center(60, " ")
version = "Version: #{MonadicGpt::VERSION}".center(60, " ")
padding = "".center(60, " ")

banner = <<~BANNER
  #{MonadicGpt::PASTEL.on_green(padding)}
  #{MonadicGpt::PASTEL.on_yellow(padding)}
  #{MonadicGpt::PASTEL.on_yellow.bold(title)}
  #{MonadicGpt::PASTEL.on_yellow(padding)}
  #{MonadicGpt::PASTEL.on_yellow(padding)}
  #{MonadicGpt::PASTEL.on_yellow(version)}
  #{MonadicGpt::PASTEL.on_yellow(padding)}
  #{MonadicGpt::PASTEL.on_green(padding)}
BANNER

openai_completion = nil
parameter = ""

loop do
  MonadicGpt.clear_screen
  print TTY::Box.frame banner.strip

  openai_completion ||= MonadicGpt.authenticate

  MonadicGpt.prompt_monadic
  parameter = MonadicGpt::PROMPT.select(" Select app:", per_page: 5, cycle: false, default: 1) do |menu|
    menu.enum "."
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Chat")}      - #{MonadicGpt::Chat::DESC}", "chat"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Code")}      - #{MonadicGpt::Code::DESC}", "code"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Novel")}     - #{MonadicGpt::Novel::DESC}", "novel"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Translate")} - #{MonadicGpt::Translate::DESC}", "translate"
    menu.choice "#{MonadicGpt::BULLET} #{MonadicGpt::PASTEL.bold("Quit")}      - Quit the app", "exit"
  end

  MonadicGpt.clear_screen

  case parameter
  when "chat"
    MonadicGpt::Chat.new(openai_completion).run
  when "code"
    MonadicGpt::Code.new(openai_completion).run
  when "novel"
    MonadicGpt::Novel.new(openai_completion).run
  when "translate"
    MonadicGpt::Translate.new(openai_completion).run
  when "exit"
    print "#{MonadicGpt::PASTEL.bold("Bye!")}\n"
    exit
  end
end
